name: Release

on:
  push:
    branches:
      - andre/openconsole

# env:
#   GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
#   CARGO_TERM_COLOR: always

jobs:
  # macos:
  #   runs-on: macos-11

  #   steps:
  #     - uses: actions/checkout@v2
  #     - name: Install ARM target
  #       run: rustup update && rustup target add aarch64-apple-darwin
  #     - name: Test
  #       run: cargo test --release
  #     - name: Build ARM
  #       run: cargo build --release --target=aarch64-apple-darwin
  #     - name: Make DMG
  #       run: make dmg-universal
  #     - name: Upload Application
  #       run: |
  #         mv ./target/release/osx/Alacritty.dmg ./Alacritty-${GITHUB_REF##*/}.dmg
  #         ./.github/workflows/upload_asset.sh ./Alacritty-${GITHUB_REF##*/}.dmg $GITHUB_TOKEN

  windows:
    runs-on: windows-latest

    defaults:
      run:
        shell: bash

    steps:
      - uses: actions/checkout@v2
      - name: Test
        run: cargo test --release
      - name: Build
        run: cargo build --release
      - uses: actions/upload-artifact@v3
        with:
          name: windows-portable
          path: ./target/release/alacritty.exe

  # linux:
  #   runs-on: ubuntu-latest

  #   steps:
  #     - uses: actions/checkout@v2
  #     - name: Install dependencies
  #       run: |
  #         sudo apt-get install cmake pkg-config libfreetype6-dev libfontconfig1-dev \
  #           libxcb-xfixes0-dev libxkbcommon-dev python3
  #     - name: Test
  #       run: cargo test --release
  #     - name: Gzip manpage
  #       run: |
  #         gzip -c "./extra/alacritty.man" > "./alacritty.1.gz"
  #         gzip -c "./extra/alacritty-msg.man" > "./alacritty-msg.1.gz"
  #     - name: Upload Assets
  #       run: |
  #         mv ./extra/logo/alacritty-term.svg ./Alacritty.svg
  #         ./.github/workflows/upload_asset.sh ./Alacritty.svg $GITHUB_TOKEN
  #         ./.github/workflows/upload_asset.sh ./alacritty.1.gz $GITHUB_TOKEN
  #         ./.github/workflows/upload_asset.sh ./alacritty-msg.1.gz $GITHUB_TOKEN
  #         ./.github/workflows/upload_asset.sh ./extra/completions/alacritty.bash $GITHUB_TOKEN
  #         ./.github/workflows/upload_asset.sh ./extra/completions/alacritty.fish $GITHUB_TOKEN
  #         ./.github/workflows/upload_asset.sh ./extra/completions/_alacritty $GITHUB_TOKEN
  #         ./.github/workflows/upload_asset.sh ./extra/linux/Alacritty.desktop $GITHUB_TOKEN
  #         ./.github/workflows/upload_asset.sh ./extra/alacritty.info $GITHUB_TOKEN
  #         ./.github/workflows/upload_asset.sh ./alacritty.yml $GITHUB_TOKEN
